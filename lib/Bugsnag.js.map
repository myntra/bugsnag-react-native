{"version":3,"sources":["../src/Bugsnag.js"],"names":[],"mappings":"gXAAA,yC;;AAEA,GAAM,cAAe,2BAAc,kBAAnC;;AAEA,GAAM,uBAAwB,EAA9B;AACA,GAAM,qBAAsB,CAAE,KAAF,CAAS,OAAT,CAAkB,MAAlB,CAA0B,MAA1B,CAAkC,OAAlC,EAA4C,MAA5C,CAAmD;AAC7E,MAAO,SAAQ,MAAR,CAAP,GAA2B,UADkD,GAAnD,CAA5B,C;;;;;;;AAQa,M,SAAA,M;;;;;AAKX,gBAAY,cAAZ,CAA4B;;;;;;;;;;;;;;;;;;;;;;;;;AAyB5B,oBAzB4B,CAyBL,UAAM;AAC3B,GAAI,UAAJ,CAAgB;AACd,GAAM,iBAAkB,WAAW,gBAAX,EAAxB;;AAEA,WAAW,gBAAX,CAA4B,SAAC,KAAD,CAAQ,OAAR,CAAoB;AAC9C,GAAI,MAAK,MAAL,CAAY,UAAZ,EAA0B,MAAK,MAAL,CAAY,YAAZ,EAA9B,CAA0D;AACxD,MAAK,MAAL,CAAY,KAAZ,CAAmB,IAAnB,CAAyB,CAAC,CAAC,aAAa,cAAxC,CAAwD,SAAC,MAAD,CAAY;AAClE,GAAI,eAAJ,CAAqB;AACnB,gBAAgB,KAAhB,CAAuB,OAAvB;AACD;AACF,CAJD,CAIG,GAAI,aAAJ,CAAiB,OAAjB,CAA0B,IAA1B,CAAgC,oBAAhC,CAJH;AAKD,CAND,IAMO,IAAI,eAAJ,CAAqB;AAC1B,gBAAgB,KAAhB,CAAuB,OAAvB;AACD;AACF,CAVD;AAWD;AACF,CAzC2B;;AA2C5B,uBA3C4B,CA2CF,UAAM;AAC9B,GAAM,UAAW,QAAQ,yCAAR,CAAjB;AACM,YADN;AAEA,SAAS,MAAT,CAAgB;AACd,cAAe,IADD;AAEd,YAAa,qBAAS,EAAT,CAAa,KAAb,CAAoB;AAC/B,OAAO,MAAP,CAAc,KAAd,CAAqB,IAArB,CAA2B,KAA3B,CAAkC,IAAlC,CAAwC,GAAI,aAAJ,CAAiB,OAAjB,CAA0B,IAA1B,CAAgC,2BAAhC,CAAxC;AACD,CAJa;AAKd,UAAW,oBAAW,CAAE,CALV,CAAhB;;AAOD,CArD2B;;;;;;;;;;;;AAiE5B,MAjE4B,CAiEnB,iBAAO,KAAP,CAAc,kBAAd,CAAkC,QAAlC,CAA4C,gBAA5C,CAA8D,aAA9D;AACD,gBAAiB,MADhB;AAEL,QAAQ,IAAR,CAAa,uDAAb;AACA,GAAI,gBAAJ;AACE,iBAAiB,KAAjB,EAJG;;;AAOF,MAAK,MAAL,CAAY,YAAZ,EAPE;AAQL,GAAI,gBAAJ;AACE,iBAAiB,KAAjB,EATG;;;;AAaD,MAbC,CAaQ,GAAI,OAAJ,CAAW,MAAK,MAAL,CAAY,MAAvB,CAA+B,KAA/B,CAAsC,aAAtC,CAbR;AAcP,OAAO,WAAP,CAAmB,KAAnB,CAA0B,cAA1B,CAA0C,MAAK,MAAL,CAAY,YAAtD,EAdO;;AAgBU,MAAK,MAAL,CAAY,mBAhBtB,uWAgBF,QAhBE,oJAgBF,QAhBE;AAiBD,SAAS,MAAT,CAAiB,KAAjB,IAA4B,KAjB3B;AAkBH,GAAI,gBAAJ;AACE,iBAAiB,KAAjB,EAnBC;;;;AAuBP,GAAI,kBAAJ,CAAwB;AACtB,mBAAmB,MAAnB;AACD;;AAEK,OA3BC,CA2BS,OAAO,MAAP,EA3BT;AA4BP,GAAI,UAAY,aAAa,cAA7B,CAA6C;AAC3C,aAAa,cAAb,CAA4B,OAA5B,CAAqC,QAArC,CAA+C,gBAA/C;AACD,CAFD,IAEO;AACL,aAAa,MAAb,CAAoB,OAApB;AACA,GAAI,gBAAJ;AACE,iBAAiB,IAAjB;AACH,CAlCM,0DAjEmB;;;AAsG5B,OAtG4B,CAsGlB,SAAC,EAAD,CAAK,IAAL,CAAW,KAAX,CAAqB;AAC7B,aAAa,OAAb,CAAqB,CAAC,KAAD,CAAK,SAAL,CAAW,WAAX,CAArB;AACD,CAxG2B;;;;;AA6G5B,SA7G4B,CA6GhB,UAAM;AAChB,aAAa,SAAb;AACD,CA/G2B;;AAiH5B,YAjH4B,CAiHb,UAAM;AACnB,aAAa,YAAb;AACD,CAnH2B;;;;;;AAyH5B,eAzH4B,CAyHV,SAAC,IAAD,CAAO,QAAP,CAAoB;AACpC,GAAI,MAAO,KAAP,GAAgB,QAApB,CAA8B;AAC5B,QAAQ,IAAR,4CAAuD,IAAvD;AACA;AACD;;AAED,GAAI,KAAK,MAAL,CAAc,qBAAlB,CAAyC;AACvC,QAAQ,IAAR,4BAAwC,qBAAxC,wBAAoF,KAAK,MAAzF,OAAqG,IAArG;AACD;;;AAGD,GAAI,UAAY,SAAhB,CAA2B;AACzB,SAAW,EAAX;AACD,CAFD,IAEO,IAAI,MAAO,SAAP,GAAoB,QAAxB,CAAkC;AACvC,SAAW,CAAE,UAAW,QAAb,CAAX;AACD,CAFM,IAEA,IAAI,MAAO,SAAP,GAAoB,QAAxB,CAAkC;AACvC,QAAQ,IAAR,2DAAsE,QAAtE;AACA,SAAW,EAAX;AACD;;AAED,GAAI,MAAO,SAAS,MAAT,GAAoB,QAA/B;AACA,GAAM,gCAA0B,QAA1B,CAAN;AACA,MAAO,oBAAmB,MAAnB,CAAP;;AAEA,aAAa,eAAb,CAA6B;AAC3B,SAD2B;AAE3B,SAF2B;AAG3B,SAAU,SAAS,kBAAT,CAHiB,CAA7B;;AAKD,CAtJ2B;;;;;;;;;;AAgK5B,wBAhK4B,CAgKD,UAAM;AAC/B,oBAAoB,OAApB,CAA4B,gBAAU;AACpC,GAAM,YAAa,QAAQ,MAAR,CAAnB;AACA,QAAQ,MAAR,EAAkB,UAAa,+BAAT,IAAS,sCAAT,IAAS;AAC7B,GAAI;AACF,MAAK,eAAL,CAAqB,SAArB,CAAgC;AAC9B,KAAM,KADwB;AAE9B,SAAU,SAAS,IAAT,CAAc,MAAd,EAAwB,KAAxB,CAAgC,MAFZ;AAG9B,QAAS;AACN,GADM,CACF,aAAO;AACV,GAAI,mBAAJ;;AAEA,GAAI,CAAE,YAAc,OAAO,GAAP,CAAd,CAA2B,CAAC,MAAO,CAAP,CAAU,CAAE;;AAE9C,GAAI,aAAe,cAAgB,iBAAnC,CAAsD,MAAO,YAAP;;AAEtD,GAAI,CAAE,YAAc,KAAK,SAAL,CAAe,GAAf,CAAoB,IAApB,CAA0B,CAA1B,CAAd,CAA4C,CAAC,MAAO,CAAP,CAAU,CAAE;;AAE/D,MAAO,YAAP;AACD,CAXM;AAYN,IAZM,CAYD,IAZC,CAHqB,CAAhC;;AAiBD,CAAC,MAAO,KAAP,CAAc;AACd,QAAQ,IAAR,gCAA4C,MAA5C,qCAAuF,KAAvF;AACD;AACD,WAAW,KAAX,CAAiB,OAAjB,CAA0B,IAA1B;AACD,CAvBD;AAwBA,QAAQ,MAAR,EAAgB,QAAhB,CAA2B,UAAM,CAAE,QAAQ,MAAR,EAAkB,UAAlB,CAA8B,CAAjE;AACD,CA3BD;AA4BD,CA7L2B;;AA+L5B,yBA/L4B,CA+LA,UAAM;AAChC,oBAAoB,OAApB,CAA4B,gBAAU;AACpC,GAAI,MAAO,SAAQ,MAAR,EAAgB,QAAvB,GAAoC,UAAxC,CAAoD,QAAQ,MAAR,EAAgB,QAAhB;AACrD,CAFD;AAGD,CAnM2B,CAC1B,GAAI,MAAO,eAAP,GAA0B,QAA1B,EAAsC,MAAO,eAAP,GAA0B,WAApE,CAAiF,CAC/E,KAAK,MAAL,CAAc,GAAI,cAAJ,CAAkB,cAAlB,CAAd,CACD,CAFD,IAEO,IAAI,yBAA0B,cAA9B,CAA6C,CAClD,KAAK,MAAL,CAAc,cAAd,CACD,CAFM,IAEA,CACL,KAAM,IAAI,MAAJ,CAAU,wEAAV,CAAN,CACD,CAED,GAAI,YAAJ,CAAkB,CAChB,aAAa,gBAAb,CAA8B,KAAK,MAAL,CAAY,MAAZ,EAA9B,EACA,KAAK,oBAAL,GACA,GAAI,KAAK,MAAL,CAAY,uBAAhB,CACE,KAAK,uBAAL,GACF,GAAI,KAAK,MAAL,CAAY,yBAAhB,CACE,KAAK,wBAAL,GACH,CAPD,IAOO,CACL,KAAM,IAAI,MAAJ,CAAU,+FAAV,CAAN,CACD,CACF,C;;;;;;;AAuLU,a,SAAA,a;;AAEX,uBAAY,MAAZ,CAAoB;;;;;;;;;;;;;;;;;;;;;AAqBpB,YArBoB,CAqBL,UAAM;AACnB,MAAO,CAAC,OAAK,YAAN;AACL,CAAC,OAAK,mBADD;AAEL,OAAK,mBAAL,CAAyB,QAAzB,CAAkC,OAAK,YAAvC,CAFF;AAGD,CAzBmB;;;;;;;AAgCpB,0BAhCoB,CAgCS,SAAC,QAAD,CAAc;AACzC,OAAK,mBAAL,CAAyB,IAAzB,CAA8B,QAA9B;AACD,CAlCmB;;;;;AAuCpB,4BAvCoB,CAuCW,SAAC,QAAD,CAAc;AAC3C,GAAM,OAAQ,OAAK,mBAAL,CAAyB,OAAzB,CAAiC,QAAjC,CAAd;AACA,GAAI,OAAS,CAAC,CAAd,CAAiB;AACf,OAAK,mBAAL,CAAyB,MAAzB,CAAgC,KAAhC,CAAuC,CAAvC;AACD;AACF,CA5CmB;;;;;AAiDpB,wBAjDoB,CAiDO,UAAM;AAC/B,OAAK,mBAAL,CAA2B,EAA3B;AACD,CAnDmB;;AAqDpB,MArDoB,CAqDX,UAAM;AACb,MAAO;AACL,OAAQ,OAAK,MADR;AAEL,aAAc,OAAK,YAFd;AAGL,aAAc,OAAK,YAHd;AAIL,oBAAqB,OAAK,mBAJrB;AAKL,SAAU,OAAK,QAAL,CAAc,QALnB;AAML,iBAAkB,OAAK,QAAL,CAAc,gBAN3B;AAOL,WAAY,OAAK,UAPZ;AAQL,WAAY,OAAK,UARZ;AASL,QAAS,OAAK,OATT;AAUL,oBAAqB,OAAK,mBAVrB;AAWL,gCAAiC,OAAK,+BAXjC,CAAP;;AAaD,CAnEmB,CAClB,GAAM,UAAW,QAAQ,iBAAR,CAAjB,CACA,KAAK,OAAL,CAAe,SAAS,SAAT,CAAf,CACA,KAAK,MAAL,CAAc,MAAd,CACA,KAAK,QAAL,CAAgB,GAAI,iBAAJ,EAAhB,CACA,KAAK,mBAAL,CAA2B,EAA3B,CACA,KAAK,mBAAL,CAA2B,SAA3B,CACA,KAAK,YAAL,CAAoB,SAApB,CACA,KAAK,UAAL,CAAkB,SAAlB,CACA,KAAK,YAAL,CAAoB,SAApB,CACA,KAAK,mBAAL,CAA2B,KAA3B,CACA,KAAK,UAAL,CAAkB,IAAlB,CACA,KAAK,uBAAL,CAA+B,CAAC,OAAhC,CACA,KAAK,yBAAL,CAAiC,KAAjC,CACA,KAAK,+BAAL,CAAuC,IAAvC,CACD,C;;;AAuDU,gB,SAAA,gB;AACX,0BAAY,QAAZ,CAAsB,gBAAtB,CAAwC;AACtC,KAAK,QAAL,CAAgB,QAAhB;AACA,KAAK,gBAAL,CAAwB,gBAAxB;AACD,C;;;AAGG,Y;AACJ,sBAAY,gBAAZ,CAA8B,SAA9B,CAAyC,cAAzC,CAAyD;AACvD,KAAK,gBAAL,CAAwB,gBAAxB;AACA,KAAK,SAAL,CAAiB,SAAjB;AACA,KAAK,cAAL,CAAsB,cAAtB;AACD,C;;;;;;AAMU,M,SAAA,M;;AAEX,gBAAY,MAAZ,CAAoB,KAApB,CAA2B,aAA3B,CAA0C;;;;;;;;;;;;;;;;;;;;;;AAsB1C,WAtB0C,CAsB5B,SAAC,OAAD,CAAU,GAAV,CAAe,KAAf,CAAyB;AACrC,GAAI,CAAC,OAAK,QAAL,CAAc,OAAd,CAAL,CAA6B;AAC3B,OAAK,QAAL,CAAc,OAAd,EAAyB,EAAzB;AACD;AACD,OAAK,QAAL,CAAc,OAAd,EAAuB,GAAvB,EAA8B,KAA9B;AACD,CA3ByC;;AA6B1C,MA7B0C,CA6BjC,UAAM;AACb,GAAI,CAAC,OAAK,aAAN,EAAuB,EAAE,OAAK,aAAL,WAA8B,aAAhC,CAA3B,CAA0E;AACxE,OAAK,aAAL,CAAqB,GAAI,aAAJ,CAAiB,SAAjB,CAA4B,KAA5B,CAAmC,kBAAnC,CAArB;AACD;;;;AAID,GAAM,iBAAkB,OAAK,aAAL,CAAmB,gBAAnB,GAAwC,OAAK,QAArE;AACA,GAAM,eAAiB,MAAO,QAAK,aAAL,CAAmB,cAA1B,GAA6C,QAApE;AACA,GAAM,cAAe,iBAAmB,aAAnB;AACpB,OAAK,aAAL,CAAmB,cADC,CACgB,yBADrC;;;;AAKA,GAAM,aAAe,MAAO,QAAK,aAAL,CAAmB,SAA1B,GAAwC,SAAzC,CAAsD,OAAK,aAAL,CAAmB,SAAzE,CAAqF,KAAzG;;AAEA,MAAO;AACL,OAAQ,OAAK,MADR;AAEL,QAAS,OAAK,OAFT;AAGL,WAAY,OAAK,UAHZ;AAIL,aAAc,OAAK,YAJd;AAKL,aAAc,OAAK,YALd;AAML,SAAU,SAAS,OAAK,QAAd,CANL;AAOL,SAAU,OAAK,QAPV;AAQL,WAAY,OAAK,UARZ;AASL,KAAM,OAAK,IATN;AAUL,gBAAiB,eAVZ;AAWL,UAAW,WAXN;AAYL,eAAgB,YAZX,CAAP;;AAcD,CA3DyC,CACxC,KAAK,MAAL,CAAc,MAAd,CACA,KAAK,UAAL,CAAkB,MAAM,WAAN,CAAkB,IAApC,CACA,KAAK,YAAL,CAAoB,MAAM,OAA1B,CACA,KAAK,OAAL,CAAe,SAAf,CACA,KAAK,YAAL,CAAoB,SAApB,CACA,KAAK,QAAL,CAAgB,EAAhB,CACA,KAAK,UAAL,CAAkB,MAAM,KAAxB,CACA,KAAK,IAAL,CAAY,EAAZ,CAEA,GAAI,CAAC,aAAD,EAAkB,EAAE,wBAAyB,aAA3B,CAAtB,CAAgE,CAC9D,cAAgB,GAAI,aAAJ,CAAiB,SAAjB,CAA4B,KAA5B,CAAmC,kBAAnC,CAAhB,CACD,CAED,KAAK,QAAL,CAAgB,cAAc,gBAA9B,CACA,KAAK,aAAL,CAAqB,aAArB,CACD,C;;;AA8CH,GAAM,uBAAwB,CAAC,QAAD,CAAW,QAAX,CAAqB,SAArB,CAA9B;;;;;;AAMA,GAAM,UAAW,QAAX,SAAW,CAAS,GAAT,CAAc;AAC7B,GAAM,QAAS,EAAf;AACA,IAAK,GAAM,IAAX,GAAkB,IAAlB,CAAuB;AACrB,GAAI,CAAC,GAAG,cAAH,CAAkB,IAAlB,CAAuB,GAAvB,CAA4B,GAA5B,CAAL,CAAuC;;AAEvC,GAAM,OAAQ,IAAI,GAAJ,CAAd;;;AAGA,GAAI,OAAS,SAAT,EAAuB,MAAO,MAAP,GAAiB,QAAjB,EAA6B,MAAM,KAAN,CAAxD,CAAuE;AACrE,OAAO,GAAP,EAAc,CAAC,KAAM,QAAP,CAAiB,MAAO,OAAO,KAAP,CAAxB,CAAd;AACD,CAFD,IAEO,IAAI,MAAO,MAAP,GAAiB,QAArB,CAA+B;AACpC,OAAO,GAAP,EAAc,CAAC,KAAM,KAAP,CAAc,MAAO,SAAS,KAAT,CAArB,CAAd;AACD,CAFM,IAEA;AACL,GAAM,MAAO,MAAO,MAApB;AACA,GAAI,sBAAsB,QAAtB,CAA+B,IAA/B,CAAJ,CAA0C;AACxC,OAAO,GAAP,EAAc,CAAC,KAAM,IAAP,CAAa,MAAO,KAApB,CAAd;AACD,CAFD,IAEO;AACL,QAAQ,IAAR,8CAAyD,GAAzD,uBAAgF,IAAhF;AACD;AACF;AACF;AACD,MAAO,OAAP;AACD,CAtBD","file":"Bugsnag.js","sourcesContent":["import { NativeModules } from 'react-native';\n\nconst NativeClient = NativeModules.BugsnagReactNative;\n\nconst BREADCRUMB_MAX_LENGTH = 30;\nconst CONSOLE_LOG_METHODS = [ 'log', 'debug', 'info', 'warn', 'error' ].filter(method =>\n  typeof console[method] === 'function'\n);\n\n\n/**\n * A Bugsnag monitoring and reporting client\n */\nexport class Client {\n\n  /**\n   * Creates a new Bugsnag client\n   */\n  constructor(apiKeyOrConfig) {\n    if (typeof apiKeyOrConfig === 'string' || typeof apiKeyOrConfig === 'undefined') {\n      this.config = new Configuration(apiKeyOrConfig);\n    } else if (apiKeyOrConfig instanceof Configuration) {\n      this.config = apiKeyOrConfig;\n    } else {\n      throw new Error('Bugsnag: A client must be constructed with an API key or Configuration');\n    }\n\n    if (NativeClient) {\n      NativeClient.startWithOptions(this.config.toJSON());\n      this.handleUncaughtErrors();\n      if (this.config.handlePromiseRejections)\n        this.handlePromiseRejections();\n      if (this.config.consoleBreadcrumbsEnabled)\n        this.enableConsoleBreadcrumbs();\n    } else {\n      throw new Error('Bugsnag: No native client found. Is BugsnagReactNative installed in your native code project?');\n    }\n  }\n\n  /**\n   * Registers a global error handler which sends any uncaught error to\n   * Bugsnag before invoking the previous handler, if any.\n   */\n  handleUncaughtErrors = () => {\n    if (ErrorUtils) {\n      const previousHandler = ErrorUtils.getGlobalHandler();\n\n      ErrorUtils.setGlobalHandler((error, isFatal) => {\n        if (this.config.autoNotify && this.config.shouldNotify()) {\n          this.notify(error, null, !!NativeClient.notifyBlocking, (queued) => {\n            if (previousHandler) {\n              previousHandler(error, isFatal);\n            }\n          }, new HandledState('error', true, 'unhandledException'));\n        } else if (previousHandler) {\n          previousHandler(error, isFatal);\n        }\n      });\n    }\n  }\n\n  handlePromiseRejections = () => {\n    const tracking = require('promise/setimmediate/rejection-tracking'),\n          client = this;\n    tracking.enable({\n      allRejections: true,\n      onUnhandled: function(id, error) {\n        client.notify(error, null, false, null, new HandledState('error', true, 'unhandledPromiseRejection'));\n      },\n      onHandled: function() {}\n    });\n  }\n\n  /**\n   * Sends an error report to Bugsnag\n   * @param error               The error instance to report\n   * @param beforeSendCallback  A callback invoked before the report is sent\n   *                            so additional information can be added\n   * @param blocking            When true, blocks the native thread execution\n   *                            until complete. If unspecified, sends the\n   *                            request asynchronously\n   * @param postSendCallback    Callback invoked after request is queued\n   */\n  notify = async (error, beforeSendCallback, blocking, postSendCallback, _handledState) => {\n    if (!(error instanceof Error)) {\n      console.warn('Bugsnag could not notify: error must be of type Error');\n      if (postSendCallback)\n        postSendCallback(false);\n      return;\n    }\n    if (!this.config.shouldNotify()) {\n      if (postSendCallback)\n        postSendCallback(false);\n      return;\n    }\n\n    const report = new Report(this.config.apiKey, error, _handledState);\n    report.addMetadata('app', 'codeBundleId', this.config.codeBundleId);\n\n    for (callback of this.config.beforeSendCallbacks) {\n      if (callback(report, error) === false) {\n        if (postSendCallback)\n          postSendCallback(false);\n        return;\n      }\n    }\n    if (beforeSendCallback) {\n      beforeSendCallback(report);\n    }\n\n    const payload = report.toJSON();\n    if (blocking && NativeClient.notifyBlocking) {\n      NativeClient.notifyBlocking(payload, blocking, postSendCallback);\n    } else {\n      NativeClient.notify(payload);\n      if (postSendCallback)\n        postSendCallback(true);\n    }\n  }\n\n  setUser = (id, name, email) => {\n    NativeClient.setUser({id, name, email});\n  }\n\n  /**\n   * Clear custom user data and reset to the default device identifier\n   */\n  clearUser = () => {\n    NativeClient.clearUser();\n  }\n\n  startSession = () => {\n    NativeClient.startSession();\n  }\n\n  /**\n   * Leaves a 'breadcrumb' log message. The most recent breadcrumbs\n   * are attached to subsequent error reports.\n   */\n  leaveBreadcrumb = (name, metadata) => {\n    if (typeof name !== 'string') {\n      console.warn(`Breadcrumb name must be a string, got '${name}'. Discarding.`);\n      return;\n    }\n\n    if (name.length > BREADCRUMB_MAX_LENGTH) {\n      console.warn(`Breadcrumb name exceeds ${BREADCRUMB_MAX_LENGTH} characters (it has ${name.length}): ${name}. It will be truncated.`);\n    }\n\n    // Checks for both `null` and `undefined`.\n    if (metadata == undefined) {\n      metadata = {};\n    } else if (typeof metadata === 'string') {\n      metadata = { 'message': metadata };\n    } else if (typeof metadata !== 'object') {\n      console.warn(`Breadcrumb metadata must be an object or string, got '${metadata}'. Discarding metadata.`);\n      metadata = {};\n    }\n\n    let type = metadata['type'] || 'manual';\n    const breadcrumbMetaData = { ...metadata };\n    delete breadcrumbMetaData['type'];\n\n    NativeClient.leaveBreadcrumb({\n      name,\n      type,\n      metadata: typedMap(breadcrumbMetaData)\n    });\n  }\n\n  /**\n   * Wraps all console log functions with a function that will leave a breadcrumb for\n   * each call, while continuing to call through to the original.\n   *\n   *   !!! Warning !!!\n   *   This will cause all log messages to originate from Bugsnag, rather than the\n   *   actual callsite of the log function in your source code.\n   */\n  enableConsoleBreadcrumbs = () => {\n    CONSOLE_LOG_METHODS.forEach(method => {\n      const originalFn = console[method];\n      console[method] = (...args) => {\n        try {\n          this.leaveBreadcrumb('Console', {\n            type: 'log',\n            severity: /^group/.test(method) ? 'log' : method,\n            message: args\n              .map(arg => {\n                let stringified\n                // do the best/simplest stringification of each argument\n                try { stringified = String(arg) } catch (e) {}\n                // unless it stringifies to [object Object], use the toString() value\n                if (stringified && stringified !== '[object Object]') return stringified\n                // otherwise attempt to JSON stringify (with indents/spaces)\n                try { stringified = JSON.stringify(arg, null, 2) } catch (e) {}\n                // any errors, fallback to [object Object]\n                return stringified\n              })\n              .join('\\n')\n          });\n        } catch (error) {\n          console.warn(`Unable to serialize console.${method} arguments to Bugsnag breadcrumb.`, error);\n        }\n        originalFn.apply(console, args);\n      }\n      console[method]._restore = () => { console[method] = originalFn }\n    });\n  }\n\n  disableConsoleBreadCrumbs = () => {\n    CONSOLE_LOG_METHODS.forEach(method => {\n      if (typeof console[method]._restore === 'function') console[method]._restore()\n    })\n  }\n}\n\n\n/**\n * Configuration options for a Bugsnag client\n */\nexport class Configuration {\n\n  constructor(apiKey) {\n    const metadata = require('../package.json');\n    this.version = metadata['version'];\n    this.apiKey = apiKey;\n    this.delivery = new StandardDelivery();\n    this.beforeSendCallbacks = [];\n    this.notifyReleaseStages = undefined;\n    this.releaseStage = undefined;\n    this.appVersion = undefined;\n    this.codeBundleId = undefined;\n    this.autoCaptureSessions = false;\n    this.autoNotify = true;\n    this.handlePromiseRejections = !__DEV__; // prefer banner in dev mode\n    this.consoleBreadcrumbsEnabled = false;\n    this.automaticallyCollectBreadcrumbs = true;\n  }\n\n  /**\n   * Whether reports should be sent to Bugsnag, based on the release stage\n   * configuration\n   */\n  shouldNotify = () => {\n    return !this.releaseStage ||\n      !this.notifyReleaseStages ||\n      this.notifyReleaseStages.includes(this.releaseStage);\n  }\n\n  /**\n   * Adds a function which is invoked after an error is reported but before\n   * it is sent to Bugsnag. The function takes a single parameter which is\n   * an instance of Report.\n   */\n  registerBeforeSendCallback = (callback) => {\n    this.beforeSendCallbacks.push(callback)\n  }\n\n  /**\n   * Remove a callback from the before-send pipeline\n   */\n  unregisterBeforeSendCallback = (callback) => {\n    const index = this.beforeSendCallbacks.indexOf(callback);\n    if (index != -1) {\n      this.beforeSendCallbacks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Remove all callbacks invoked before reports are sent to Bugsnag\n   */\n  clearBeforeSendCallbacks = () => {\n    this.beforeSendCallbacks = []\n  }\n\n  toJSON = () => {\n    return {\n      apiKey: this.apiKey,\n      codeBundleId: this.codeBundleId,\n      releaseStage: this.releaseStage,\n      notifyReleaseStages: this.notifyReleaseStages,\n      endpoint: this.delivery.endpoint,\n      sessionsEndpoint: this.delivery.sessionsEndpoint,\n      appVersion: this.appVersion,\n      autoNotify: this.autoNotify,\n      version: this.version,\n      autoCaptureSessions: this.autoCaptureSessions,\n      automaticallyCollectBreadcrumbs: this.automaticallyCollectBreadcrumbs,\n    };\n  }\n}\n\nexport class StandardDelivery {\n  constructor(endpoint, sessionsEndpoint) {\n    this.endpoint = endpoint;\n    this.sessionsEndpoint = sessionsEndpoint;\n  }\n}\n\nclass HandledState {\n  constructor(originalSeverity, unhandled, severityReason) {\n    this.originalSeverity = originalSeverity;\n    this.unhandled = unhandled;\n    this.severityReason = severityReason;\n  }\n}\n\n/**\n * A report generated from an error\n */\nexport class Report {\n\n  constructor(apiKey, error, _handledState) {\n    this.apiKey = apiKey;\n    this.errorClass = error.constructor.name;\n    this.errorMessage = error.message;\n    this.context = undefined;\n    this.groupingHash = undefined;\n    this.metadata = {};\n    this.stacktrace = error.stack;\n    this.user = {};\n\n    if (!_handledState || !(_handledState instanceof HandledState)) {\n      _handledState = new HandledState('warning', false, 'handledException');\n    }\n\n    this.severity = _handledState.originalSeverity;\n    this._handledState = _handledState;\n  }\n\n  /**\n   * Attach additional diagnostic data to the report. The key/value pairs\n   * are grouped into sections.\n   */\n  addMetadata = (section, key, value) => {\n    if (!this.metadata[section]) {\n      this.metadata[section] = {};\n    }\n    this.metadata[section][key] = value;\n  }\n\n  toJSON = () => {\n    if (!this._handledState || !(this._handledState instanceof HandledState)) {\n      this._handledState = new HandledState('warning', false, 'handledException');\n    }\n    // severityReason must be a string, and severity must match the original\n    // state, otherwise we assume that the user has modified _handledState\n    // in a callback\n    const defaultSeverity = this._handledState.originalSeverity === this.severity;\n    const isValidReason = (typeof this._handledState.severityReason === 'string');\n    const severityType = defaultSeverity && isValidReason ?\n     this._handledState.severityReason : 'userCallbackSetSeverity';\n\n    // if unhandled not set, user has modified the report in a callback\n    // or via notify, so default to false\n    const isUnhandled = (typeof this._handledState.unhandled === 'boolean') ? this._handledState.unhandled : false;\n\n    return {\n      apiKey: this.apiKey,\n      context: this.context,\n      errorClass: this.errorClass,\n      errorMessage: this.errorMessage,\n      groupingHash: this.groupingHash,\n      metadata: typedMap(this.metadata),\n      severity: this.severity,\n      stacktrace: this.stacktrace,\n      user: this.user,\n      defaultSeverity: defaultSeverity,\n      unhandled: isUnhandled,\n      severityReason: severityType\n    }\n  }\n}\n\nconst allowedMapObjectTypes = ['string', 'number', 'boolean'];\n\n/**\n * Convert an object into a structure with types suitable for serializing\n * across to native code.\n */\nconst typedMap = function(map) {\n  const output = {};\n  for (const key in map) {\n    if (!{}.hasOwnProperty.call(map, key)) continue;\n\n    const value = map[key];\n\n    // Checks for `null`, NaN, and `undefined`.\n    if (value == undefined || (typeof value === 'number' && isNaN(value))) {\n      output[key] = {type: 'string', value: String(value)}\n    } else if (typeof value === 'object') {\n      output[key] = {type: 'map', value: typedMap(value)};\n    } else {\n      const type = typeof value;\n      if (allowedMapObjectTypes.includes(type)) {\n        output[key] = {type: type, value: value};\n      } else {\n        console.warn(`Could not serialize breadcrumb data for '${key}': Invalid type '${type}'`);\n      }\n    }\n  }\n  return output;\n}\n"]}